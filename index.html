<!doctype html>
<html>
<head>
<title> MIA BDAY </title>
<style>
img {
  height: 22vh;
  min-height: 13em;
  column-count: 3;
}
</style>
</head>
<body>

<p>Happy (almost) 100th birthday to the MIA! Start celebrating early with us by giving the gift of art to your online community. Simply select the work you’d like to share, pick your social platform, and inspire wonder through the power of art, just like that. Feels good, doesn’t it?</p>

<div>
<img src="./images/crop/1743.jpg">
<img src="./images/crop/10436.jpg">
<img src="./images/crop/12092.jpg">
<img src="./images/crop/10434.jpg">
<img src="./images/crop/60728.jpg">
<img src="./images/crop/529.jpg">
<img src="./images/crop/98653.jpg">
<img src="./images/crop/3520.jpg">
<img src="./images/crop/5788.jpg">
<img src="./images/crop/303.jpg">
<img src="./images/crop/10361.jpg">
<img src="./images/crop/794.jpg">
</div>

<script src="node_modules/hellojs/dist/hello.all.js"></script>
<script src="bundle.js"></script>
<script>
  hello.init({ 
    facebook : 283514835175411,
    twitter: 'vJyAEOhA6UfAizVYCoLc0hbye'
  }, {
    redirect_uri: 'authed.html',
    oauth_proxy : 'https://glacial-waters-7413.herokuapp.com/proxy',
    scope: 'photos,publish_files'
  })

  document.addEventListener('click', function(event) {
    var id = event.target.src.match(/images\/crop\/(\d+)/)[1]
    if(event.target.nodeName == 'IMG' && id) {
      facebook(id)
      twitter(id)
    }
  })

  function url(img, width) {
    return 'http://cdn.dx.artsmia.org/miabday/images/logo/'+img+'-'+width+'.jpg'
  }

  function facebook(img) {
    var _art = art[img]
    if(!_art) return
    var credit = _art.title
    if(_art.artist && _art.artist != 'Unknown') credit += " by "+_art.artist

    var message = "Happy (almost) 100th birthday to the MIA! I’m celebrating with "+credit+".\n\nWant to join the party? Visit artsmia.org/100 to give the gift of art to your online community."
    hello('facebook').login().then(function(auth) {
      hello('facebook').api('me/photos', 'POST', {
        message: message, url: url(img, 3000)
      }).then(function(success) { console.log('facebook', success) }, function(err) { console.log(err) })
    })
  }
  function twitter(img) {
    var message = "Happy (almost) 100th #BDAYMIA! Celebrate with a gift of art to your community—visit artsmia.org/100 & share."
    loadImage(img, function(err, dataUrl) {
      hello('twitter').login().then(function(auth) {
        window.bench = new Date
        hello('twitter').api('me/media', 'POST', {
          message: message, file: dataUrl, filename: 'artsmia-bday-gift-'+img+'.jpg'
        }).then(function(success) { console.log('twitter', success, 'took ', (new Date - bench)/1000, 'seconds') }, function(err) { console.log(err) })
      }, function(error) {
        console.log('no twitter! ', error)
      })
    })
  }
</script>
</body>
</html>
